let created = false;
let preloaderVisible = true;
let rootAsset;
let divs = [];


export default class SplashScreen {

    static show(_rootAsset) {

        rootAsset = _rootAsset;

        SplashScreen.enabled = true;

        $("#videoPlayer-SplashScreen").show();

        /* populate */
        if (!created) {
            created = true;
            const posterFolder = "../data/poster/";
            let images = [];
            var e = $('#splashScreen-div');


            for (let i = 0; i < rootAsset.length; i++) {

                images[i] = posterFolder + rootAsset[i].poster_url;
                var $url = images[i];
                var title = rootAsset[i].title;
                var description = rootAsset[i].description;
                var id = rootAsset[i].id;
                var location = rootAsset[i].location;

                if (i === 0) {
                    divs.push(e);
                } else {
                    var f = e.clone().insertAfter(e);
                    divs.push(f);
                }

                divs[i].data({ id: id });
                divs[i].find('.splashScreen-poster').attr('src', $url);
                divs[i].find('.splashScreen-title').text(title);
                divs[i].find('.splashScreen-location').text(location);
                divs[i].find('.splashScreen-description').text(description);



                // divs[i].hover(
                //     function() {
                //         divs[i].css('background-color', 'rgba(26, 27, 33, 1');

                //         /* send message */
                //         window.dispatcher.sendMessage("splashScreenOver", divs[i].data().id);
                //     },
                //     function() {
                //         divs[i].css('background-color', 'rgba(26, 27, 33, 0.4');

                //         /* send message */
                //         window.dispatcher.sendMessage("splashScreenExit", divs[i].data().id);
                //     });
                divs[i].click(
                    function() {

                        /* send message */
                        window.dispatcher.sendMessage("splashScreenClicked", divs[i].data().id);
                    },
                )

            };


            /// use readmore HERE!
            var fontSize = $('.splashScreen-description').css('font-size');
            var lineHeight = Math.floor(parseInt(fontSize.replace('px', '')) * 1.5);
            var numberOfLines = 2;

            new Readmore('.splashScreen-description', {
                speed: 200,
                // lessLink: '<a href="#">Read less</a>',
                collapsedHeight: lineHeight * numberOfLines,
                moreLink: '<button style="width:80px; height:30px; background-color: transparent; border-radius: 5px; border: 1px solid rgb(130, 130, 130); color: rgb(130, 130, 130); text-align: center; text-decoration: none; display: inline-block; font-size: 11px; cursor: pointer;">Read more</button>',
                lessLink: '<button style="width:80px; height:30px; background-color: transparent; border-radius: 5px; border: 1px solid rgb(130, 130, 130); color: rgb(130, 130, 130); text-align: center; text-decoration: none; display: inline-block; font-size: 11px; cursor: pointer;">Read less</button>',
            });

            $(".preloader").fadeOut();
            preloaderVisible = false;
        }
    };



    static hide() {
        console.log("HIDE...")
        $("#videoPlayer-SplashScreen").hide();
        $("#Clappr-container").show();
    }

    // static hideImmediately() {
    //     $("#videoPlayer-SplashScreen").hide();
    // }

    // static hidePreloader(){
    //     if (preloaderVisible){
    //         $("#videoPlayer-preloader").fadeOut();
    //         preloaderVisible = false;
    //     }
    // }

    static hideForSingleVideo() {
        if (preloaderVisible) {
            $("#videoPlayer-SplashScreen").hide();
            $("#Clappr-container").show();
            $(".preloader").fadeOut();
            preloaderVisible = false;
        }
    }
}

SplashScreen.enabled = false;



/********************************************
Receive messages
********************************************/
let selectedDiv = null;
window.dispatcher.receiveMessage("videoAssetOver", function(asset) {
    let index;
    for (let i = 0; i < rootAsset.length; i++) {
        if (asset.title === rootAsset[i].title) {
            index = i;
            break;
        }
    }
    selectedDiv = divs[index];
    selectedDiv.css('background-color', 'rgba(0,0,0,1');
});

window.dispatcher.receiveMessage("videoAssetExit", function() {
    if (selectedDiv) {
        selectedDiv.css('background-color', 'rgba(0,0,0,0.4');
    }
});